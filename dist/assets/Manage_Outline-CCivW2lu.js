import{_ as T,r as E,c as a,o as d,a as e,b,d as u,F as g,f as v,n as x,t as h,w,e as y,p as O,v as C,q as N,s as j,u as k,i as M,x as S,y as A}from"./index-DyH5Twdd.js";const J={name:"OutlineGenerator",data(){return{outlineTitles:[],selectedOutline:null,isLoading:!1,showViewModal:!1,currentTitle:"",currentOutlineContent:{outline:{},character:[]},isViewLoading:!1,viewError:"",showEditModal:!1,editOutlineContent:{title:"",outlineText:"",outlineJson:[],characters:[]},editOutlineFormat:{outline:"text",character:"array"},isEditLoading:!1,editError:"",isSaving:!1,newPropertyKey:"",standardProperties:["name","gender","age","appearance","personality","relations","others"],propertyLabels:{name:"名称",gender:"性别",age:"年龄",appearance:"外貌",personality:"性格",relations:"关系",others:"其他"},showDeleteModal:!1,outlineToDelete:"",isDeleting:!1,showExportModal:!1,outlineToExport:"",isExportLoading:!1,notification:{show:!1,message:"",type:"info",timeout:null}}},mounted(){this.loadOutlineTitles()},methods:{async loadOutlineTitles(){this.isLoading=!0;try{this.outlineTitles=await A();let n=this.outlineTitles.indexOf("test");n!==-1&&this.outlineTitles.splice(n,1)}catch(n){console.error("加载大纲标题失败:",n),this.showNotification("加载大纲列表失败","error")}finally{this.isLoading=!1}},selectOutline(n){this.selectedOutline=n},async viewOutline(n){this.currentTitle=n,this.showViewModal=!0,this.isViewLoading=!0,this.viewError="";try{const t=await k(n);this.currentOutlineContent=t}catch(t){console.error("加载大纲详情失败:",t),this.viewError="加载大纲内容失败: "+(t.message||"未知错误"),this.showNotification("加载大纲内容失败","error")}finally{this.isViewLoading=!1}},async editOutline(n){this.showViewModal&&(this.showViewModal=!1),this.currentTitle=n,this.showEditModal=!0,this.isEditLoading=!0,this.editError="",this.newPropertyKey="";try{const t=await k(n);this.detectAndSetEditFormat(t),this.prepareEditContent(t)}catch(t){console.error("加载大纲编辑数据失败:",t),this.editError="加载大纲内容失败: "+(t.message||"未知错误"),this.showNotification("加载编辑数据失败","error")}finally{this.isEditLoading=!1}},detectAndSetEditFormat(n){var t;typeof((t=n.outline)==null?void 0:t.outline)=="object"&&n.outline.outline!==null&&!Array.isArray(n.outline.outline)?this.editOutlineFormat.outline="json":this.editOutlineFormat.outline="text",this.editOutlineFormat.character="array"},prepareEditContent(n){var t,l,c;this.editOutlineContent.title=((t=n.outline)==null?void 0:t.title)||"",this.editOutlineFormat.outline==="json"?(this.editOutlineContent.outlineJson=this.convertObjectToJsonItems((l=n.outline)==null?void 0:l.outline),this.editOutlineContent.outlineText=""):(this.editOutlineContent.outlineText=this.convertOutlineToText((c=n.outline)==null?void 0:c.outline),this.editOutlineContent.outlineJson=[]),this.editOutlineContent.characters=this.convertToCharacterArray(n.character)},convertToCharacterArray(n){return n?Array.isArray(n)?n.map((t,l)=>({name:t.name||`角色 ${l+1}`,gender:t.gender||"",age:t.age===void 0||t.age===null||isNaN(t.age)?null:Number(t.age),...t})):typeof n=="object"&&n!==null?Object.entries(n).map(([t,l])=>typeof l=="object"&&l!==null&&!Array.isArray(l)?{name:t,...l}:{name:t,description:String(l)}):typeof n=="string"?[{name:"角色",description:n}]:[this.createEmptyCharacter()]:[this.createEmptyCharacter()]},createEmptyCharacter(){return{name:"",gender:"",age:null,appearance:"",personality:"",relations:"",others:""}},addCharacter(){this.editOutlineContent.characters.push(this.createEmptyCharacter())},removeCharacter(n){this.editOutlineContent.characters.splice(n,1),this.editOutlineContent.characters.length===0&&this.addCharacter()},getEditableProperties(n){const t={};if(n&&typeof n=="object")for(const l in n)n.hasOwnProperty(l)&&!["name","gender","age"].includes(l)&&(t[l]=n[l]);return t},addCharacterProperty(n){if(!n||typeof n!="object")return;const t=this.newPropertyKey.trim();if(!t){this.showNotification("属性名称不能为空","warning");return}if(t.includes(".")||t.includes("$")||t.includes("#")||t.includes("[")||t.includes("]")){this.showNotification("属性名称不能包含特殊字符 (. $ # [ ])","warning");return}if(n.hasOwnProperty(t)){this.showNotification(`角色已存在属性 "${t}"`,"warning");return}n[t]="",this.standardProperties.includes(t)||(this.standardProperties.push(t),this.propertyLabels[t]=t),this.newPropertyKey=""},removeCharacterProperty(n,t){n&&typeof n=="object"&&n.hasOwnProperty(t)&&delete n[t]},getPropertyLabel(n){return this.propertyLabels[n]||n},convertObjectToJsonItems(n){return!n||typeof n!="object"||Array.isArray(n)?[]:Object.entries(n).map(([t,l])=>({key:t,value:typeof l=="object"?JSON.stringify(l,null,2):String(l)}))},convertOutlineToText(n){if(!n)return"";if(typeof n=="string")return n;if(Array.isArray(n))return n.map(t=>typeof t=="object"?JSON.stringify(t,null,2):String(t)).join(`

`);if(typeof n=="object"&&n!==null){let t="";for(const[l,c]of Object.entries(n)){const o=typeof c=="object"?JSON.stringify(c,null,2):String(c);t+=`${l}:
${o}

`}return t.trim()}return""},addOutlineJsonItem(){this.editOutlineContent.outlineJson.push({key:"",value:""})},removeOutlineJsonItem(n){this.editOutlineContent.outlineJson.splice(n,1)},async saveEditedOutline(){if(this.isSaving=!0,this.editError="",!this.editOutlineContent.title||this.editOutlineContent.title.trim()===""){this.showNotification("大纲标题不能为空","error"),this.isSaving=!1;return}try{const n={title:this.editOutlineContent.title.trim()};if(this.editOutlineFormat.outline==="json"){const c={};for(const o of this.editOutlineContent.outlineJson)if(o.key.trim())try{c[o.key.trim()]=JSON.parse(o.value)}catch{c[o.key.trim()]=o.value}n.outline=c}else n.outline=this.editOutlineContent.outlineText;const t=this.editOutlineContent.characters.map(c=>{const o={};for(const r in c)if(c.hasOwnProperty(r)){const s=c[r];r==="age"?s!==null&&s!==""&&!isNaN(s)&&(o[r]=Number(s)):s!==null&&s!==""&&s!==void 0&&(o[r]=s)}return o}).filter(c=>Object.keys(c).length>0);await S(this.currentTitle,n,t)?(this.showNotification("大纲保存成功","success"),this.showEditModal=!1,await this.loadOutlineTitles(),this.editOutlineContent.title.trim()!==this.currentTitle?this.selectedOutline=this.editOutlineContent.title.trim():this.selectedOutline=this.currentTitle):this.showNotification("大纲保存失败","error")}catch(n){console.error("保存大纲失败:",n),this.showNotification("保存大纲时发生错误: "+(n.message||"未知错误"),"error"),this.editError="保存失败: "+(n.message||"未知错误")}finally{this.isSaving=!1}},confirmDeleteOutline(n){this.outlineToDelete=n,this.showDeleteModal=!0},async deleteOutline(){this.isDeleting=!0;try{await M(`/data/${this.outlineToDelete}`),this.showNotification(`大纲 "${this.outlineToDelete}" 已删除`,"success"),this.showDeleteModal=!1,await this.loadOutlineTitles(),this.selectedOutline===this.outlineToDelete&&(this.selectedOutline=null)}catch(n){console.error("删除大纲失败:",n),this.showNotification("删除大纲失败: "+(n.message||"未知错误"),"error")}finally{this.isDeleting=!1}},exportOutline(n){this.outlineToExport=n,this.showExportModal=!0,this.isExportLoading=!0,k(n).then(t=>{this.currentOutlineContent=t,this.isExportLoading=!1}).catch(t=>{console.error("加载大纲导出数据失败:",t),this.showNotification("准备导出数据失败","error"),this.showExportModal=!1})},exportAsJson(){var n,t;try{const l={outline:{title:((n=this.currentOutlineContent.outline)==null?void 0:n.title)||"",outline:(t=this.currentOutlineContent.outline)==null?void 0:t.outline},character:this.currentOutlineContent.character},c=new Blob([JSON.stringify(l,null,2)],{type:"application/json"});this.createDownload(c,`${this.outlineToExport}.json`),this.showExportModal=!1,this.showNotification("大纲已导出为JSON格式","success")}catch(l){console.error("导出JSON失败:",l),this.showNotification("导出JSON失败: "+(l.message||"未知错误"),"error")}},exportAsText(){var n,t;try{let l=`标题: ${((n=this.currentOutlineContent.outline)==null?void 0:n.title)||""}

`;l+=`==== 剧情大纲 ====

`,l+=this.convertOutlineToText((t=this.currentOutlineContent.outline)==null?void 0:t.outline),l+=`

==== 角色设定 ====

`;const c=this.currentOutlineContent.character;if(Array.isArray(c))c.forEach((r,s)=>{l+=`【${r.name||`角色 ${s+1}`}】
`,r.gender&&(l+=`性别: ${r.gender}
`),r.age!==void 0&&r.age!==null&&!isNaN(r.age)&&(l+=`年龄: ${r.age}岁
`),Object.entries(r||{}).forEach(([i,f])=>{!["name","gender","age"].includes(i)&&f!==void 0&&f!==null&&f!==""&&(l+=`${this.getPropertyLabel(i)}: ${f}
`)}),l+=`
`});else if(typeof c=="string")l+=c;else if(typeof c=="object"&&c!==null)for(const[r,s]of Object.entries(c)){const i=typeof s=="object"?JSON.stringify(s,null,2):String(s);l+=`${r}:
${i}

`}const o=new Blob([l.trim()],{type:"text/plain;charset=utf-8"});this.createDownload(o,`${this.outlineToExport}.txt`),this.showExportModal=!1,this.showNotification("大纲已导出为文本格式","success")}catch(l){console.error("导出文本失败:",l),this.showNotification("导出文本失败: "+(l.message||"未知错误"),"error")}},exportAsMarkdown(){var n,t;try{let l=`# ${((n=this.currentOutlineContent.outline)==null?void 0:n.title)||"无标题大纲"}

`;l+=`## 剧情大纲

`;const c=(t=this.currentOutlineContent.outline)==null?void 0:t.outline;if(typeof c=="string")l+=c.replace(/\n/g,`

`);else if(Array.isArray(c))c.forEach(s=>{const i=typeof s=="object"?`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\``:String(s);l+=`- ${i}
`});else if(typeof c=="object"&&c!==null)for(const[s,i]of Object.entries(c)){const f=typeof i=="object"?`\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\``:String(i).replace(/\n/g,`
  `);l+=`### ${s}

${f}

`}l+=`
## 角色设定

`;const o=this.currentOutlineContent.character;if(Array.isArray(o))o.forEach((s,i)=>{l+=`### ${s.name||`角色 ${i+1}`}

`;let f="";s.gender&&(f+=`- **性别**: ${s.gender}
`),s.age!==void 0&&s.age!==null&&!isNaN(s.age)&&(f+=`- **年龄**: ${s.age}岁
`),f&&(l+=`${f}
`),Object.entries(s||{}).forEach(([p,m])=>{!["name","gender","age"].includes(p)&&m!==void 0&&m!==null&&m!==""&&(l+=`#### ${this.getPropertyLabel(p)}

${m}

`)})});else if(typeof o=="string")l+=o.replace(/\n/g,`

`);else if(typeof o=="object"&&o!==null)for(const[s,i]of Object.entries(o)){const f=typeof i=="object"?`\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\``:String(i).replace(/\n/g,`
  `);l+=`### ${s}

${f}

`}const r=new Blob([l.trim()],{type:"text/markdown;charset=utf-8"});this.createDownload(r,`${this.outlineToExport}.md`),this.showExportModal=!1,this.showNotification("大纲已导出为Markdown格式","success")}catch(l){console.error("导出Markdown失败:",l),this.showNotification("导出Markdown失败: "+(l.message||"未知错误"),"error")}},createDownload(n,t){const l=URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.download=t,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(l)},100)},showNotification(n,t="info"){this.notification.timeout&&clearTimeout(this.notification.timeout),this.notification={show:!0,message:n,type:t,timeout:setTimeout(()=>{this.notification.show=!1},3e3)}},getNotificationIconName(){return{success:"circle-check",error:"circle-xmark",warning:"exclamation-triangle",info:"info-circle"}[this.notification.type]||"info-circle"},removeCharacterProperty(n,t){n&&typeof n=="object"&&n.hasOwnProperty(t)&&!this.standardProperties.includes(t)?delete n[t]:this.standardProperties.includes(t)&&this.showNotification(`无法删除标准属性 "${this.getPropertyLabel(t)}"`,"warning")}}},P={class:"outline-generator"},V={class:"main-container-simplified"},L={class:"outlines-panel"},D={class:"panel-header"},U={class:"panel-content"},F={key:0,class:"loading-state"},I={key:1,class:"empty-state"},B={key:2,class:"outlines-list"},R=["onClick"],K={class:"outline-icon"},q={class:"outline-info"},z={class:"outline-title"},G={class:"outline-actions"},H=["onClick"],Q=["onClick"],W=["onClick"],X=["onClick"],Y={class:"modal-content view-modal"},Z={class:"modal-header"},$={class:"modal-body"},tt={key:0,class:"modal-loading"},et={key:1,class:"modal-error"},nt={key:2,class:"outline-content"},it={class:"outline-section title-section"},ot={class:"section-content"},st={class:"outline-section outline-section"},lt={class:"section-content"},rt={key:0},at={key:1},dt={key:2},ct={key:0},ut={key:1},ft={class:"outline-section character-section"},ht={class:"section-content"},pt={key:0},yt={class:"character-header"},mt={class:"character-name"},bt={key:0,class:"character-badge"},gt={key:1,class:"character-badge age-badge"},vt={class:"character-properties"},Ot={class:"property-label"},wt={class:"property-value"},Ct={key:1},kt={key:2},_t={key:0},xt={key:1},Tt={class:"modal-footer"},Et={class:"modal-content edit-modal"},Nt={class:"modal-header"},jt={class:"modal-body"},Mt={key:0,class:"modal-loading"},St={key:1,class:"modal-error"},At={key:2,class:"edit-form"},Jt={class:"form-group"},Pt={for:"edit-title"},Vt={class:"form-group"},Lt={for:"edit-outline"},Dt={key:0,class:"json-editor"},Ut={class:"json-item-header"},Ft=["onUpdate:modelValue"],It=["onClick"],Bt=["onUpdate:modelValue"],Rt={class:"form-group"},Kt={class:"characters-editor"},qt={class:"character-edit-header"},zt={class:"character-title-group"},Gt={class:"character-edit-title"},Ht=["onClick"],Qt={class:"character-basic-info"},Wt={class:"character-field"},Xt=["onUpdate:modelValue"],Yt={class:"character-field"},Zt=["onUpdate:modelValue"],$t={class:"character-field"},te=["onUpdate:modelValue"],ee={class:"character-properties-edit"},ne={class:"property-edit-header"},ie=["onClick"],oe=["onUpdate:modelValue","placeholder"],se={class:"add-property"},le={class:"add-property-field"},re=["onKeyup"],ae=["onClick","disabled"],de={class:"modal-footer"},ce=["disabled"],ue={class:"modal-content delete-modal"},fe={class:"modal-header"},he={class:"modal-body"},pe={class:"delete-confirmation"},ye={class:"modal-footer"},me=["disabled"],be={class:"modal-content export-modal"},ge={class:"modal-header"},ve={class:"modal-body"},Oe={key:0,class:"modal-loading"},we={key:1,class:"export-options"},Ce={class:"export-format-options"},ke={class:"modal-footer"};function _e(n,t,l,c,o,r){const s=E("font-awesome-icon");return d(),a("div",P,[e("div",V,[e("div",L,[e("div",D,[t[24]||(t[24]=e("h2",null,"大纲管理",-1)),e("button",{class:"refresh-btn icon-btn",onClick:t[0]||(t[0]=(...i)=>r.loadOutlineTitles&&r.loadOutlineTitles(...i)),title:"刷新列表"},[u(s,{icon:["fas","sync-alt"]})])]),e("div",U,[o.isLoading?(d(),a("div",F,[u(s,{icon:["fas","spinner"],spin:"",class:"loading-icon-fa"}),t[25]||(t[25]=e("span",null,"加载中...",-1))])):o.outlineTitles.length===0?(d(),a("div",I,[u(s,{icon:["fas","file-lines"],class:"empty-icon-fa"}),t[26]||(t[26]=e("p",null,"暂无大纲",-1))])):(d(),a("div",B,[(d(!0),a(g,null,v(o.outlineTitles,i=>(d(),a("div",{key:i,class:x(["outline-item",{active:o.selectedOutline===i}]),onClick:f=>r.selectOutline(i)},[e("div",K,[u(s,{icon:["fas","book-open"]})]),e("div",q,[e("div",z,h(i),1),e("div",G,[e("button",{class:"action-btn view-btn",onClick:w(f=>r.viewOutline(i),["stop"]),title:"查看"},[u(s,{icon:["fas","eye"],class:"action-btn-icon-fa"})],8,H),e("button",{class:"action-btn edit-btn",onClick:w(f=>r.editOutline(i),["stop"]),title:"编辑"},[u(s,{icon:["fas","pen-to-square"],class:"action-btn-icon-fa"})],8,Q),e("button",{class:"action-btn export-btn",onClick:w(f=>r.exportOutline(i),["stop"]),title:"导出"},[u(s,{icon:["fas","file-export"],class:"action-btn-icon-fa"})],8,W),e("button",{class:"action-btn delete-btn",onClick:w(f=>r.confirmDeleteOutline(i),["stop"]),title:"删除"},[u(s,{icon:["fas","trash-alt"],class:"action-btn-icon-fa"})],8,X)])])],10,R))),128))]))])])]),o.showViewModal?(d(),a("div",{key:0,class:"modal",onClick:t[4]||(t[4]=w(i=>o.showViewModal=!1,["self"]))},[e("div",Y,[e("div",Z,[e("h2",null,"大纲查看: "+h(o.currentTitle),1),e("button",{class:"close-btn icon-btn",onClick:t[1]||(t[1]=i=>o.showViewModal=!1),title:"关闭"},[u(s,{icon:["fas","times"]})])]),e("div",$,[o.isViewLoading?(d(),a("div",tt,[u(s,{icon:["fas","spinner"],spin:"",class:"modal-loading-icon-fa"}),t[27]||(t[27]=e("span",null,"加载中...",-1))])):o.viewError?(d(),a("div",et,[u(s,{icon:["fas","exclamation-triangle"],class:"modal-error-icon-fa"}),e("span",null,h(o.viewError),1)])):(d(),a("div",nt,[e("div",it,[e("h3",null,[u(s,{icon:["fas","thumbtack"],class:"section-icon-fa"}),t[28]||(t[28]=y(" 标题 "))]),e("div",ot,[e("p",null,h(o.currentOutlineContent.outline.title),1)])]),e("div",st,[e("h3",null,[u(s,{icon:["fas","scroll"],class:"section-icon-fa"}),t[29]||(t[29]=y(" 剧情大纲 "))]),e("div",lt,[typeof o.currentOutlineContent.outline.outline=="string"?(d(),a("div",rt,[e("p",null,h(o.currentOutlineContent.outline.outline),1)])):Array.isArray(o.currentOutlineContent.outline.outline)?(d(),a("div",at,[e("ul",null,[(d(!0),a(g,null,v(o.currentOutlineContent.outline.outline,(i,f)=>(d(),a("li",{key:f},h(i),1))),128))])])):(d(),a("div",dt,[(d(!0),a(g,null,v(o.currentOutlineContent.outline.outline,(i,f)=>(d(),a("div",{key:f,class:"outline-section-item"},[e("h4",null,h(f),1),typeof i=="string"?(d(),a("p",ct,h(i),1)):(d(),a("pre",ut,h(JSON.stringify(i,null,2)),1))]))),128))]))])]),e("div",ft,[e("h3",null,[u(s,{icon:["fas","users"],class:"section-icon-fa"}),t[30]||(t[30]=y(" 角色设定 "))]),e("div",ht,[Array.isArray(o.currentOutlineContent.character)?(d(),a("div",pt,[(d(!0),a(g,null,v(o.currentOutlineContent.character,(i,f)=>(d(),a("div",{key:f,class:"character-card"},[e("div",yt,[e("h4",mt,h(i.name||`角色 ${f+1}`),1),i.gender?(d(),a("span",bt,h(i.gender),1)):b("",!0),i.age!==void 0&&i.age!==null?(d(),a("span",gt,h(i.age)+"岁",1)):b("",!0)]),e("div",vt,[n.key!=="name"&&n.key!=="gender"&&n.key!=="age"?(d(!0),a(g,{key:0},v(i,(p,m)=>(d(),a("div",{key:m,class:"character-property"},[e("div",Ot,h(r.getPropertyLabel(m)),1),e("div",wt,h(p),1)]))),128)):b("",!0)])]))),128))])):typeof o.currentOutlineContent.character=="string"?(d(),a("div",Ct,[e("p",null,h(o.currentOutlineContent.character),1)])):(d(),a("div",kt,[(d(!0),a(g,null,v(o.currentOutlineContent.character,(i,f)=>(d(),a("div",{key:f,class:"character-item"},[e("h4",null,h(f),1),typeof i=="string"?(d(),a("p",_t,h(i),1)):(d(),a("pre",xt,h(JSON.stringify(i,null,2)),1))]))),128))]))])])]))]),e("div",Tt,[e("button",{class:"secondary-btn",onClick:t[2]||(t[2]=i=>o.showViewModal=!1)},[u(s,{icon:["fas","times"],class:"btn-icon-fa"}),t[31]||(t[31]=y(" 关闭 "))]),e("button",{class:"primary-btn",onClick:t[3]||(t[3]=i=>r.editOutline(o.currentTitle))},[u(s,{icon:["fas","pen"],class:"btn-icon-fa"}),t[32]||(t[32]=y(" 编辑大纲 "))])])])])):b("",!0),o.showEditModal?(d(),a("div",{key:1,class:"modal",onClick:t[13]||(t[13]=w(i=>o.showEditModal=!1,["self"]))},[e("div",Et,[e("div",Nt,[e("h2",null,"大纲编辑: "+h(o.currentTitle),1),e("button",{class:"close-btn icon-btn",onClick:t[5]||(t[5]=i=>o.showEditModal=!1),title:"关闭"},[u(s,{icon:["fas","times"]})])]),e("div",jt,[o.isEditLoading?(d(),a("div",Mt,[u(s,{icon:["fas","spinner"],spin:"",class:"modal-loading-icon-fa"}),t[33]||(t[33]=e("span",null,"加载中...",-1))])):o.editError?(d(),a("div",St,[u(s,{icon:["fas","exclamation-triangle"],class:"modal-error-icon-fa"}),e("span",null,h(o.editError),1)])):(d(),a("div",At,[e("div",Jt,[e("label",Pt,[u(s,{icon:["fas","thumbtack"],class:"form-icon-fa"}),t[34]||(t[34]=y(" 标题 "))]),O(e("input",{type:"text",id:"edit-title","onUpdate:modelValue":t[6]||(t[6]=i=>o.editOutlineContent.title=i),placeholder:"输入标题"},null,512),[[C,o.editOutlineContent.title]])]),e("div",Vt,[e("label",Lt,[u(s,{icon:["fas","scroll"],class:"form-icon-fa"}),t[35]||(t[35]=y(" 剧情大纲 "))]),o.editOutlineFormat.outline==="json"?(d(),a("div",Dt,[(d(!0),a(g,null,v(o.editOutlineContent.outlineJson,(i,f)=>(d(),a("div",{key:f,class:"json-item"},[e("div",Ut,[O(e("input",{type:"text","onUpdate:modelValue":p=>i.key=p,placeholder:"键名",class:"json-key-input"},null,8,Ft),[[C,i.key]]),e("button",{class:"remove-json-btn icon-btn",onClick:p=>r.removeOutlineJsonItem(f),title:"删除项"},[u(s,{icon:["fas","minus"]})],8,It)]),O(e("textarea",{"onUpdate:modelValue":p=>i.value=p,placeholder:"值 (可以是纯文本或JSON字符串)",rows:"3",class:"json-value-input"},null,8,Bt),[[C,i.value]])]))),128)),e("button",{class:"add-json-btn",onClick:t[7]||(t[7]=(...i)=>r.addOutlineJsonItem&&r.addOutlineJsonItem(...i))},[u(s,{icon:["fas","plus"]}),t[36]||(t[36]=y(" 添加项 "))])])):O((d(),a("textarea",{key:1,id:"edit-outline","onUpdate:modelValue":t[8]||(t[8]=i=>o.editOutlineContent.outlineText=i),placeholder:"输入剧情大纲",rows:"8"},null,512)),[[C,o.editOutlineContent.outlineText]])]),e("div",Rt,[e("label",null,[u(s,{icon:["fas","users"],class:"form-icon-fa"}),t[37]||(t[37]=y(" 角色设定 "))]),e("div",Kt,[(d(!0),a(g,null,v(o.editOutlineContent.characters,(i,f)=>(d(),a("div",{key:f,class:"character-edit-card"},[e("div",qt,[e("div",zt,[e("h4",Gt,"角色 "+h(f+1),1),e("button",{class:"remove-character-btn icon-btn",onClick:p=>r.removeCharacter(f),title:"删除角色"},[u(s,{icon:["fas","minus"]})],8,Ht)]),e("div",Qt,[e("div",Wt,[t[38]||(t[38]=e("label",null,"名称",-1)),O(e("input",{type:"text","onUpdate:modelValue":p=>i.name=p,placeholder:"角色名称",class:"character-input"},null,8,Xt),[[C,i.name]])]),e("div",Yt,[t[40]||(t[40]=e("label",null,"性别",-1)),O(e("select",{"onUpdate:modelValue":p=>i.gender=p,class:"character-input"},t[39]||(t[39]=[e("option",{value:""},"选择性别",-1),e("option",{value:"男"},"男",-1),e("option",{value:"女"},"女",-1),e("option",{value:"其他"},"其他",-1)]),8,Zt),[[N,i.gender]])]),e("div",$t,[t[41]||(t[41]=e("label",null,"年龄",-1)),O(e("input",{type:"number","onUpdate:modelValue":p=>i.age=p,placeholder:"年龄",class:"character-input",min:"0"},null,8,te),[[C,i.age,void 0,{number:!0}]])])])]),e("div",ee,[(d(!0),a(g,null,v(r.getEditableProperties(i),(p,m)=>(d(),a("div",{key:m,class:"character-property-edit"},[e("div",ne,[e("label",null,h(r.getPropertyLabel(m)),1),o.standardProperties.includes(m)?b("",!0):(d(),a("button",{key:0,class:"remove-json-btn icon-btn remove-property-btn",onClick:_=>r.removeCharacterProperty(i,m),title:"删除属性"},[u(s,{icon:["fas","minus"]})],8,ie))]),O(e("textarea",{"onUpdate:modelValue":_=>i[m]=_,placeholder:`输入${r.getPropertyLabel(m)}`,rows:"3",class:"property-textarea"},null,8,oe),[[C,i[m]]])]))),128)),e("div",se,[e("div",le,[O(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=p=>o.newPropertyKey=p),placeholder:"属性名称",class:"property-key-input",onKeyup:j(p=>r.addCharacterProperty(i),["enter"])},null,40,re),[[C,o.newPropertyKey]]),e("button",{class:"add-property-btn",onClick:p=>r.addCharacterProperty(i),disabled:!o.newPropertyKey.trim()},[u(s,{icon:["fas","plus"]}),t[42]||(t[42]=y(" 添加属性 "))],8,ae)])])])]))),128)),e("button",{class:"add-character-btn",onClick:t[10]||(t[10]=(...i)=>r.addCharacter&&r.addCharacter(...i))},[u(s,{icon:["fas","plus"]}),t[43]||(t[43]=y(" 添加角色 "))])])])]))]),e("div",de,[e("button",{class:"secondary-btn",onClick:t[11]||(t[11]=i=>o.showEditModal=!1)},[u(s,{icon:["fas","ban"],class:"btn-icon-fa"}),t[44]||(t[44]=y(" 取消 "))]),e("button",{class:"primary-btn",onClick:t[12]||(t[12]=(...i)=>r.saveEditedOutline&&r.saveEditedOutline(...i)),disabled:o.isSaving},[u(s,{icon:["fas",o.isSaving?"spinner":"floppy-disk"],spin:o.isSaving,class:"btn-icon-fa"},null,8,["icon","spin"]),y(" "+h(o.isSaving?"保存中...":"保存修改"),1)],8,ce)])])])):b("",!0),o.showDeleteModal?(d(),a("div",{key:2,class:"modal",onClick:t[17]||(t[17]=w(i=>o.showDeleteModal=!1,["self"]))},[e("div",ue,[e("div",fe,[t[45]||(t[45]=e("h2",null,"确认删除",-1)),e("button",{class:"close-btn icon-btn",onClick:t[14]||(t[14]=i=>o.showDeleteModal=!1),title:"关闭"},[u(s,{icon:["fas","times"]})])]),e("div",he,[e("div",pe,[u(s,{icon:["fas","exclamation-triangle"],class:"warning-icon-fa"}),e("p",null,[t[46]||(t[46]=y("确定要删除大纲 ")),e("strong",null,'"'+h(o.outlineToDelete)+'"',1),t[47]||(t[47]=y(" 吗？"))]),t[48]||(t[48]=e("p",{class:"delete-warning"},"此操作无法撤销！",-1))])]),e("div",ye,[e("button",{class:"secondary-btn",onClick:t[15]||(t[15]=i=>o.showDeleteModal=!1)},[u(s,{icon:["fas","ban"],class:"btn-icon-fa"}),t[49]||(t[49]=y(" 取消 "))]),e("button",{class:"danger-btn",onClick:t[16]||(t[16]=(...i)=>r.deleteOutline&&r.deleteOutline(...i)),disabled:o.isDeleting},[u(s,{icon:["fas",o.isDeleting?"spinner":"trash-alt"],spin:o.isDeleting,class:"btn-icon-fa"},null,8,["icon","spin"]),y(" "+h(o.isDeleting?"删除中...":"确认删除"),1)],8,me)])])])):b("",!0),o.showExportModal?(d(),a("div",{key:3,class:"modal",onClick:t[23]||(t[23]=w(i=>o.showExportModal=!1,["self"]))},[e("div",be,[e("div",ge,[e("h2",null,"导出大纲: "+h(o.outlineToExport),1),e("button",{class:"close-btn icon-btn",onClick:t[18]||(t[18]=i=>o.showExportModal=!1),title:"关闭"},[u(s,{icon:["fas","times"]})])]),e("div",ve,[o.isExportLoading?(d(),a("div",Oe,[u(s,{icon:["fas","spinner"],spin:"",class:"modal-loading-icon-fa"}),t[50]||(t[50]=e("span",null,"准备导出数据中...",-1))])):(d(),a("div",we,[t[54]||(t[54]=e("p",null,"请选择要导出的格式：",-1)),e("div",Ce,[e("button",{class:"export-format-btn",onClick:t[19]||(t[19]=(...i)=>r.exportAsJson&&r.exportAsJson(...i))},[u(s,{icon:["fas","file"],class:"export-format-icon-fa"}),t[51]||(t[51]=e("span",{class:"btn-text"},"JSON格式",-1))]),e("button",{class:"export-format-btn",onClick:t[20]||(t[20]=(...i)=>r.exportAsText&&r.exportAsText(...i))},[u(s,{icon:["fas","file-lines"],class:"export-format-icon-fa"}),t[52]||(t[52]=e("span",{class:"btn-text"},"文本格式",-1))]),e("button",{class:"export-format-btn",onClick:t[21]||(t[21]=(...i)=>r.exportAsMarkdown&&r.exportAsMarkdown(...i))},[u(s,{icon:["fab","markdown"],class:"export-format-icon-fa"}),t[53]||(t[53]=e("span",{class:"btn-text"},"Markdown格式",-1))])])]))]),e("div",ke,[e("button",{class:"secondary-btn",onClick:t[22]||(t[22]=i=>o.showExportModal=!1)},[u(s,{icon:["fas","ban"],class:"btn-icon-fa"}),t[55]||(t[55]=y(" 取消 "))])])])])):b("",!0),o.notification.show?(d(),a("div",{key:4,class:x(["notification",o.notification.type])},[u(s,{icon:["fas",r.getNotificationIconName()],class:"notification-icon-fa"},null,8,["icon"]),e("span",null,h(o.notification.message),1)],2)):b("",!0)])}const Te=T(J,[["render",_e],["__scopeId","data-v-44b727e5"]]);export{Te as default};
